<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>AR Robot Single Bed Mission</title>
<style>
  body{margin:0;overflow:hidden;}
  canvas{display:block;}
</style>
</head>
<body>

<script src="https://cdn.jsdelivr.net/npm/three@0.128/build/three.min.js"></script>
<script type="module">
import { ARButton } from 'https://cdn.jsdelivr.net/npm/three@0.128/examples/jsm/webxr/ARButton.js';
import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.128/examples/jsm/loaders/GLTFLoader.js';

let scene, camera, renderer;
let robot, bed;

init();
animate();

function init(){
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.01, 20);

    renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.xr.enabled = true;
    document.body.appendChild(renderer.domElement);
    document.body.appendChild(ARButton.createButton(renderer,{requiredFeatures:['hit-test']}));

    const light = new THREE.HemisphereLight(0xffffff,0x444444,1);
    scene.add(light);

    // --- Load Robot model ---
    const loader = new GLTFLoader();
    loader.load('robot.glb', (gltf)=>{
        robot = gltf.scene;
        robot.scale.set(0.2,0.2,0.2);
        robot.position.set(0,0,0); // starting position
        scene.add(robot);
    });

    // --- Create ONE bed far from robot ---
    const bedMat = new THREE.MeshStandardMaterial({color:0xff9999});
    bed = new THREE.Mesh(new THREE.BoxGeometry(0.5,0.1,0.25), bedMat);
    bed.position.set(0,0,-1.5); // far from robot
    scene.add(bed);

    // --- Tap bed ---
    window.addEventListener('click',(e)=>{
        const mouse = new THREE.Vector2();
        mouse.x = ( e.clientX / window.innerWidth ) * 2 - 1;
        mouse.y = - ( e.clientY / window.innerHeight ) * 2 + 1;
        const raycaster = new THREE.Raycaster();
        raycaster.setFromCamera(mouse, camera);
        const intersects = raycaster.intersectObject(bed);
        if(intersects.length > 0){
            showMessage("Mission Successful!", bed.position);
            confetti({ particleCount:200, spread:120, origin:{y:0.6} });
        }
    });
}

// --- Floating black text ---
function showMessage(text,pos){
    const canvas=document.createElement('canvas'); canvas.width=256; canvas.height=128;
    const ctx=canvas.getContext('2d');
    ctx.fillStyle="rgba(255,255,255,0)";
    ctx.fillRect(0,0,256,128);
    ctx.font="20px Arial"; ctx.fillStyle="black"; ctx.textAlign="center"; ctx.fillText(text,128,64);
    const tex=new THREE.CanvasTexture(canvas);
    const sprite=new THREE.Sprite(new THREE.SpriteMaterial({map:tex,transparent:true}));
    sprite.position.copy(pos); sprite.position.y+=0.3; sprite.scale.set(0.6,0.3,0.3);
    scene.add(sprite);
    setTimeout(()=>scene.remove(sprite),2000);
}

// --- Animate loop ---
function animate(){
    renderer.setAnimationLoop(render);
}

function render(){
    renderer.render(scene,camera);
}

// --- confetti ---
const script=document.createElement('script');
script.src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js";
document.body.appendChild(script);

</script>

</body>
</html>
